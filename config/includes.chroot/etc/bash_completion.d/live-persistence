# file: live-persistence
# live-persistence parameter-completion

_live-persistence ()
{
  local cur

  COMPREPLY=()
  cur="${COMP_WORDS[COMP_CWORD]}"
  prev="${COMP_WORDS[COMP_CWORD-1]}"

  switches="-h --help -l --log-file= -e --encryption= -m --media= -g --gpt-only -r --read-only -w --read-write -u --union="

  opts="activate close list"
  case "$prev" in
    activate)
      local parts=$(live-persistence list)
      COMPREPLY=( $( compgen -W "${parts}" -- ${cur} ) )
      return 0
      ;;
    close)
      local parts=$(mount | grep '/persistence/' | cut -f1 -d ' ')
      COMPREPLY=( $( compgen -W "${parts}" -- ${cur} ) )
      return 0
      ;;
    list)
      return 0
      ;;
  esac

  if [[ ${prev} == live-persistence ]] || [[ ${prev} == -* ]]
  then
    opts="${switches} ${opts}"
  fi
  COMPREPLY=($(compgen -W "${opts} " -- ${cur}))  
  return 0
}

complete -F _live-persistence live-persistence
